!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CoCreate=t():(e.CoCreate=e.CoCreate||{},e.CoCreate.crud=t())}(this,(function(){return e={446:function(e,t){var n;"undefined"!=typeof self&&self,void 0===(n=function(){return function(e){function t(){let t={};return e&&e.config&&(t=e.config),{apiKey:t.apiKey,organization_id:t.organization_Id}}function n(t){let n={};return e&&e.config&&(n=e.config),{apiKey:t.apiKey||n.apiKey,organization_id:t.organization_id||n.organization_Id}}function o(t,n){let o={};e&&e.config&&(o=e.config);let r=t||o.organization_Id,s=n||"";return s?`${r}/${s}`:r}function r(e=36){let t=(new Date).getTime(),n=0,o="uxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx";if(e<=o.length)o=o.substr(0,e);else{let t=e-o.length,n="-xxxyyxxx",r=Math.floor(t/n.length);for(let e=0;e<r;e++)o+=n;r=t-r*n.length,o+=n.substr(0,r)}return o.replace(/[xy]/g,(function(e){var o=16*Math.random();return t>0?(o=(t+o)%16|0,t=Math.floor(t/16)):(o=(n+o)%16|0,n=Math.floor(n/16)),("x"==e?o:7&o|8).toString(16)}))}return{getCommonParams:t,getCommonParamsExtend:n,generateSocketClient:o,GenerateUUID:r}}(window)}.apply(t,[]))||(e.exports=n)},585:function(e,t,n){var o,r;"undefined"!=typeof self&&self,o=[n(446)],void 0===(r=function(e){return function(e,t,n,o){class r{constructor(e="crud"){this.prefix=e||"crud",this.sockets=new Map,this.listeners=new Map,this.messageQueue=new Map,this.saveFileName="",this.globalScope=""}setGlobalScope(e){this.globalScope=`${this.prefix}/${e}`}getGlobalScope(){return this.globalScope}create(e){const{namespace:r,room:s}=e,i=this.getKey(r,s);let c,a=this;if(r&&this.setGlobalScope(r),this.sockets.get(i))return void(c=this.sockets.get(i));let u=t.location.protocol;"about:"===t.location.protocol&&(u=t.parent.location.protocol,e.host||(e.host=t.parent.location.host));let l="http:"===u?"ws":"wss";const d=e.port?e.port:8088;let f=`${l}://${t.location.host}:${d}/${i}`;e.host&&(f=e.host.includes("://")?`${e.host}/${i}`:e.host.includes(":")?`${l}://${e.host}/${i}`:`${l}://${e.host}:${d}/${i}`);try{let e=null;t.localStorage&&(e=t.localStorage.getItem("token")),c=new n(f,e)}catch(e){return}c.onopen=function(e){(a.messageQueue.get(i)||[]).forEach((e=>c.send(JSON.stringify(e)))),a.sockets.set(i,c),a.messageQueue.set(i,[])},c.onclose=function(t){switch(t.code){case 1e3:break;default:a.destroy(c,i),a.reconnect(c,e)}},c.onerror=function(t){a.destroy(c,i),a.reconnect(c,e)},c.onmessage=function(e){try{if(t.Blob&&e.data instanceof o)return void a.saveFile(e.data);let r=JSON.parse(e.data);if(r.data.event){if(t.CustomEvent){var n=new t.CustomEvent(r.data.event,{detail:r.data});return void t.document.dispatchEvent(n)}return void process.emit(r.data.event,r.data)}r.action;const s=a.listeners.get(r.action);if(!s)return;s.forEach((e=>{e(r.data,i)}))}catch(e){}}}send(t,n,o){const r={action:t,data:{...n,uid:e.GenerateUUID()}},s=this.getKeyByRoom(o),i=this.getByRoom(o);i?i.send(JSON.stringify(r)):this.messageQueue.get(s)?this.messageQueue.get(s).push(r):this.messageQueue.set(s,[r])}sendFile(e,t){const n=this.getByRoom(t);n&&n.send(e)}listen(e,t){this.listeners.get(e)?this.listeners.get(e).push(t):this.listeners.set(e,[t])}reconnect(e,t){let n=this;setTimeout((function(){n.create(t)}),1e3)}destroy(e,t){e&&(e.onerror=e.onopen=e.onclose=null,e.close(),e=null),this.sockets.get(t)&&this.sockets.delete(t)}destroyByKey(e){let t=this.sockets.get(e);t&&this.destroy(t,e)}getKey(e,t){let n=`${this.prefix}`;return e&&""!=e&&(n+=t&&""!=t?`/${e}/${t}`:`/${e}`),n}getByRoom(e){let t=this.getKeyByRoom(e);return this.sockets.get(t)}getKeyByRoom(e){let t=this.globalScope;return e&&(t=`${this.prefix}/${e}`),t}saveFile(e){if(t.document){const o=this.saveFileName||"downloadFile";var n=t.document.createElement("a");t.document.body.appendChild(n),n.style="display: none";let r=window.URL.createObjectURL(e);n.href=r,n.download=o,n.click(),t.URL.revokeObjectURL(r),this.saveFileName=""}}listenAsync(e){return new Promise(((n,o)=>{t.document?t.document.addEventListener(e,(function(e){n(e.detail)}),{once:!0}):process.once(e,(e=>{n(e)}))}))}}return r}(e,window,WebSocket,Blob)}.apply(t,o))||(e.exports=r)},541:(e,t,n)=>{"use strict";var o,r;"undefined"!=typeof self&&self,o=[n(446),n(158)],void 0===(r=function(e,t){return function(e,t,n){return{socket:null,setSocket:function(e){this.socket=e},readDocumentList(e){if(!e)return!1;let n=t.getCommonParams();return!!e.collection&&(n={...n,...e},this.socket.send("readDocumentList",n),!0)},createDocument:function(n){if(null===n)return!1;let o=t.getCommonParamsExtend(n),r={...n,...o},s=n.data||{};s.organization_id||(s.organization_id=e.config.organization_Id),n.data&&(s={...s,...n.data}),r.data=s;const i=t.generateSocketClient(n.namespace,n.room);return this.socket.send("createDocument",r,i),!0},updateDocument:function(e){if(!e||!n.checkDocumentId(e.document_id))return!1;let o=t.getCommonParamsExtend(e),r={...e,...o};if("object"==typeof e.data&&(r.set=e.data),Array.isArray(e.delete_fields)&&(r.unset=e.delete_fields),!r.set&&!r.unset)return!1;!1===e.broadcast&&(r.broadcast=!1),void 0===e.broadcast_sender&&(r.broadcast_sender=!0);const s=t.generateSocketClient(e.namespace,e.room);return this.socket.send("updateDocument",r,s),!0},readDocument:function(e){if(null===e)return!1;if(!e||!n.checkDocumentId(e.document_id))return!1;let o=t.getCommonParamsExtend(e),r={...e,...o};return this.socket.send("readDocument",r),!0},deleteDocument:function(e){if(!e||!n.checkDocumentId(e.document_id))return!1;let o=t.getCommonParamsExtend(e),r={...e,...o};const s=t.generateSocketClient(e.namespace,e.room);return this.socket.send("deleteDocument",r,s),!0},exportCollection:function(e){if(null===e)return;let n=t.getCommonParamsExtend(e);n.collection=e.collection,n.export_type=e.export_type,n.metadata=e.metadata,this.socket.send("exportDB",n)},importCollection:function(n){const{file:o}=n;if(null===n||!(o instanceof e.File))return;const r=o.name.split(".").pop();if(!["json","csv"].some((e=>e===r)))return;let s=t.getCommonParamsExtend(n);s.collection=n.collection,s.import_type=r,this.socket.send("importDB",s),this.socket.sendFile(o)},listen:function(e,t){this.socket.listen(e,t)},listenAsync:function(e){return this.socket.listenAsync(e)},createSocket:function(e,t){t?(this.socket.create({namespace:t,room:null,host:e}),this.socket.setGlobalScope(t)):this.socket.create({namespace:null,room:null,host:e})},...n}}(window,e,t)}.apply(t,o))||(e.exports=r)},352:(e,t,n)=>{"use strict";var o,r;"undefined"!=typeof self&&self,o=[n(585),n(541)],void 0===(r=function(e,t){return function(e,t,n){if(e){let e=window.CoCreateCrudSocket;e||(e=new t("ws"),window.CoCreateCrudSocket=e),n.setSocket(e),n.createSocket(window.config.host?window.config.host:window.location.hostname,window.config.organization_Id)}return n}(!0,e,t)}.apply(t,o))||(e.exports=r)},158:(e,t)=>{"use strict";var n;"undefined"!=typeof self&&self,void 0===(n=function(){return function(){function e(t,n){t=t||{};for(let o of Object.keys(n))n[o]instanceof Object&&Object.assign(n[o],e(t[o],n[o]));return Object.assign(t||{},n),t}function t(e,t){if(!t)return e;let n=t.split("."),o=e;for(var r=n.length-1;r>=0;r--)o={[n[r]]:o};return o}function n(e,t){try{let n=/([\w\W]+)\[(\d+)\]/gm.exec(e);if(n&&3==n.length){let o=n[1],r=parseInt(n[2]);t[o]&&Array.isArray(t[o])||(t[o]=[]),t[o][r]=t[e],delete t[e],e=o}}catch{}return e}function o(e){return!!e&&e.constructor===Object}function r(e){return!!e&&e.constructor===Array}function s(o){let r=Object.keys(o),s={};return r.forEach((r=>{if((r=n(r,o)).split(".").length>1){let n=t(o[r],r);delete o[r],s=e(s,n)}else s[r]=o[r]})),s}function i(e){let t=Object.keys(e),n={};return t.forEach((t=>{let s=e[t];if(o(e[t])){let o=i(e[t]);Object.keys(o).forEach((e=>{let r=o[e];n[e=t+"."+e]=r}))}else r(s)?s.forEach(((e,o)=>{n[`${t}[${o}]`]=e})):n[t]=e[t]})),n}function c(e){if(e)return{collection:e.getAttribute("data-collection"),document_id:e.getAttribute("data-document_id"),name:e.getAttribute("name")}}function a(e){return e?{is_realtime:f(e),is_save:l(e),is_read:u(e),is_update:d(e)}:{}}const u=e=>m(e,"data-read_value"),l=e=>m(e,"data-save_value"),d=e=>m(e,"data-update_value"),f=e=>!!e&&"false"!=e.getAttribute("data-realtime");function m(e,t){return!!e&&"false"!==e.getAttribute(t)}function p(e){return!!e&&!/{{\s*([\w\W]+)\s*}}/g.test(e)}function h(e){try{let t=JSON.parse(e);return"object"==typeof t&&null!=t}catch(e){return!1}}function g(e){const{collection:t,document_id:n,name:o}=c(e);return!(h(t)||h(o)||!("INPUT"===e.tagName&&["text","email","tel","url"].includes(e.type)||"TEXTAREA"===e.tagName)||!o||!f(e)||"true"===e.getAttribute("data-unique")||"password"===e.type||!u(e))}function y(e){try{return!!e&&"null"!==e.toLowerCase()}catch(e){return!1}}return{decodeObject:s,encodeObject:i,getAttr:c,getFlagAttr:a,isRealtimeAttr:f,isReadAttr:u,isSaveAttr:l,isUpdateAttr:d,checkValue:p,isCRDT:g,checkDocumentId:y}}()}.apply(t,[]))||(e.exports=n)}},t={},function n(o){var r=t[o];if(void 0!==r)return r.exports;var s=t[o]={exports:{}};return e[o].call(s.exports,s,s.exports,n),s.exports}(352).default;var e,t}));